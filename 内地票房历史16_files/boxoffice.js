var utils=utils||{};!function(e){var t=function(){function e(){}return e.prototype.get=function(e,t){var a=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=decodeURI(window.location.search).substr(1).match(a);return null!==n?decodeURIComponent(n[2]):"undefined"!=typeof t?t:null},e}();e.url=new t}(utils);var version="07bb781100018dd58eafc3b35d42686804c6df8d";!function(e){var t={china:{title:"内地票房 - 电影票房 - Mtime时光网的",keywords:"电影票房,内地票房,内地排名",description:"内地电影票房排行榜,Mtime时光网"},NorthAmerica:{title:"北美票房 - 电影票房 - Mtime时光网",keywords:"电影票房,北美票房,北美排名",description:"北美电影票房排行榜,Mtime时光网"},global:{title:"全球票房 - 电影票房 - Mtime时光网",keywords:"电影票房,全球票房,全球排名",description:"全球电影票房排行榜,Mtime时光网。"}},a=function(){function a(){this.data={year:null,area:null,type:"MovieRankingDay",category:"all",page:0,display:"list"}}return a.prototype.getYear=function(){return this.data.year},a.prototype.getArea=function(){return this.data.area},a.prototype.getType=function(){return this.data.type},a.prototype.getCategory=function(){return this.data.category},a.prototype.getPage=function(){return this.data.page},a.prototype.getDisplay=function(){return this.data.display},a.prototype.setYear=function(e){return this.data.year=e,this},a.prototype.setArea=function(a){this.data.area=a;var n=t[a];return document.title=n.title,e("meta[name=keywords]").attr("content",n.keywords),e("meta[name=description]").attr("content",n.description),this},a.prototype.setCategory=function(e){return this.data.category=e,this},a.prototype.setType=function(e){return this.data.type=e,this},a.prototype.setPage=function(e){return this.data.page=parseInt(e),this},a.prototype.setDisplay=function(e){return this.data.display=e,this},a.prototype.clearData=function(){for(var e in this.data)null===this.data[e]&&(this.data[e]=void 0)},a.prototype.render=function(t){var a=this;void 0===t&&(t=null),this.clearData(),null===t&&(t=function(){a.restoreScene(!1)}),this.data.timestamp=(new Date).getTime(),this.data.version=version,this.data.dataType="json",e.ajax({url:"/boxoffice/",data:this.data,success:function(a){e(".bocontent").replaceWith(a.html),t()},error:function(){alert("稍候再试~")}})},a.prototype.restoreScene=function(t){if(void 0===t&&(t=!1),e(".tabtype>a").removeClass("cur"),e('.tabtype>a[data-category="'+n.getCategory()+'"]').addClass("cur"),e(".ico-display").removeClass("cur"),e('.recentcont .ico-display[data-display="'+n.getDisplay()+'"]').addClass("cur"),e(".recentcont .pagesize>a").removeClass("cur"),e('.recentcont .pagesize>a[data-page="'+n.getPage()+'"]').addClass("cur"),t===!0){var a=e(".recentmenu h5."+n.getArea()).addClass("cur").next().removeClass("none");e("div.recentmenu dt.cur").removeClass("cur"),e("a."+n.getType(),a).parent().addClass("cur");e("dd."+n.getType(),a).removeClass("none").prev().addClass("cur").end().find('a[data-date="'+n.getYear()+'"]').parent().addClass("cur").end()}},a}(),n=new a;e(".recentmenu dt").on("click",function(){e(".recentmenu dt").removeClass("cur");var t=e(this).toggleClass("cur").next("dd,dl"),a=t.hasClass("none");e(".recentmenu dd").addClass("none"),a?(t.removeClass("none"),t.children().first().children("a").trigger("click")):t.addClass("none").prev().removeClass("cur")}),e(".recentmenu h5").on("click",function(){var t=e(this).toggleClass("cur").next("dd,dl");t.toggleClass("none ")}),e("div.recentmenu > ul > li > dl > dd > p > a").on("click",function(){e(this).parent().siblings().removeClass("cur").end().addClass("cur")}),e(".recentcont").on("click",".ico-display",function(){var t=e(this).data("display");n.setDisplay(t),n.render()}),e(".recentcont").on("click",".totalrank",function(){var t=e(this).data("area"),a=parseInt(e(this).data("rank")),r=a/10;r=Math.ceil(r)-1,n.setType("MovieRankingHistory"),n.setArea(t),n.setPage(r),n.render(function(){n.restoreScene(!0);var e=window.location.href,t=[];t=e.split("#"),e=t[0]+("#MovieRankingHistory-rank-"+a),window.location.href=e})}),e(".recentcont").on("click",".tabtype>a",function(){var t=e(this).data("category");n.setPage(0).setCategory(t).render()}),e(".recentcont").on("click",".pagesize>a",function(){var t=e(this).data("page");n.setPage(t).render()}),e(".MovieRankingDay").on("click",function(){var t=e(this).data("area");n.setType("MovieRankingDay").setCategory("all").setArea(t).setDisplay("list").setPage(0).render()}),e(".MovieRankingHistory").on("click",function(){n.setType("MovieRankingHistory").setCategory("all").setArea(e(this).data("area")).setDisplay("list").setPage(0).render()}),e(".MovieRankingYear > p > a").on("click",function(){n.setType("MovieRankingYear").setCategory("all").setYear(e(this).text()).setArea(e(this).parent().parent().data("area")).setDisplay("list").setPage(0).render()}),n.setYear(utils.url.get("year")).setArea(utils.url.get("area","china")).setType(utils.url.get("type","MovieRankingDay")).setCategory(utils.url.get("category")).setPage(utils.url.get("page",0)).setDisplay(utils.url.get("display","list"));var r=window.location.href.split("#");if("undefined"!=typeof r[1]&&""!==r[1]){var i=r[1].split("/"),s=i[0],o=i[1];switch(s){case"CN":s="china";break;case"US":s="NorthAmerica";break;default:s="global"}switch(n.setArea(s),o){case"weekend":o="MovieRankingDay",n.setType(o);break;case"daily":o="MovieRankingDay",n.setType(o);break;case"all":o="MovieRankingHistory",n.setType(o);break;default:n.setType("MovieRankingYear"),n.setYear(o)}n.setCategory("all"),n.render(function(){n.restoreScene(!0)})}else n.setArea("china"),n.setType("MovieRankingDay"),n.restoreScene(!0)}(jQuery);